---
- name: Ping servers
  ansible.builtin.ping:
  register: ping_res
  changed_when: true
  notify: Handler invoked by name
  tags: check-res
  
- name: Check res
  debug:
    msg: "{{ping_res}}"
  changed_when: true
  notify: handler invoked by listener

# loop keywordによってtaskをあるリストに対して繰り返し実行できる
# task内ではitemという変数で参照される
- name: Loop test
  debug:
    msg: "{{ item.test1 }} : {{ item.test2 }}"
  loop: 
    - {test1: "item1", test2: "item1"}
    - {test1: "item2", test2: "item2"}
  register: res

# loopの結果はregister keywordで指定した変数に追加されていく
- name: Loop res
  debug:
    msg: "{{res}}"

# until keywordによってtaskを条件が満たされるまで実行できる
# リトライ数はretries, 間隔はdelay
- name: Tasks with until
  debug:
    msg: "loop test"
  register: result
  until: result.changed
  retries: 5
  delay: 1
